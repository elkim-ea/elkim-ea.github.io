---
layout: post
title: " 2.AWS(SAA) - EC2 fundamentals (Kor.ver) "
date: 2025-11-22
categories:
  - "Certification/AWS SAA"
---

#### Reference
- [Udemy – AWS Certified Solutions Architect Associate (SAA-C03)](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/?couponCode=CP251120G2)

---
# 1. EC2 Basics
## Amazon EC
- EC2 = Elastic Compute Cloud = Infrastructure as a Service
- 구성 요소
  - 가상 머신을 대여 가능 = EC2 Instance 라고 함
  - 가상 드라이브 또는 EBS 볼륨에 데이터를 저장
  - 탄력적인 로드 밸런서를 통해 여러 머신에 부하를 분산 (ELB)
  - 자동확장 그룹 또는 ASG를 사용하여 서비스 확장 (ASG)
- 클라우드는 필요할 때마다 온디맨드 방식으로 컴퓨팅을 대여 할 수 있는것

---

## EC2 sizing & configuration options
- Operating System (OS) : Linux, Windows or Mac OS
- 가상 머신에 얼마나 많은 컴퓨팅 성능과 코어의 양 (CPU)
- 랜덤 액세스 메모리 양 (RAM)
- 저장 공간의 양
  - 네트워크 연결 (EBS & EFS)
  - 하드웨어 (ES2 Instance Store)
- Network card : 빠른 네크워크 카드, 공인 IP주소
- Firewall rules : 보안 그룹
- Bootstrap script (configure at first launch) : EC2 사용자 데이터
- 비주얼 머신을 원하는 대로 선택 가능, AWS에서 대여 가능

---

## EC2 User Data
- EC2 사용자 데이터 스크립트를 사용하여 인스턴스를 부트스트랩 할 수 있음
- **Bootstrap 이란?** : 컴퓨터가 시작될 때 명령을 실행하는 것이며, 그 이후에는 다시 실행되지 않음
- EC2 사용자 데이터는 부팅 작업을 자동화함 이것을 **부트스트래핑** 이라고 함
  - 업데이트 설치
  - 소프트웨어 설치
  - 일반적인 파일 다운로드
  - 생각한 모든것들          
  : 따라서 원하는 대로 설정할 수 있지만 사용자 데이터 스크립트에 더 많은것을 추가할 수록 부팅시 인스턴스가 수행해야 하는 작업이 많아 짐
- EC2 사용자 데이터 스크립트는 루트 사용자로 실행되므로 어떤 명령이든 sudo 권한을 가짐

---

# 2. EC2 Instance Types Basics
## EC2 Instance Types - Overview
- 7가지의 유형의 EC2 인스턴스 있음
- m : instance class
- 5 : generation (AWS improves them over time)
- 2xlarge : size within the instance class

---

## EC2 Instance Types - General Purpose
- 웹서버나 코드 저장소 등 다양한 위크로드에 적합한 범용성을 갖춰있음 
- 균형이 잘 잡혀있음 (컴퓨팅, 메모리, 네트워크 간의 균형)
- t2 : 범용 인스턴스 유형인 마이크로 인스턴스임

---

## EC2 Instance Types - Compute Optimized
- 집약적인 컴퓨팅 작업에 최적화된 인스턴스
  - Batch processing workloads
  - Media transcoding
  - High performance web servers
  - High performance computing (HPC)
  - Scientific modeling & machine learning
  - Dedicated gaming servers

---

## EC2 Instance Types - Memory Optimized
- 매우 빠른 성능을 제공 (메모리는 RAM임)
- 사용 사례
  - High performance, relational/non-relational databases
  - Distributed web scale cache stores
  - In-memory databases optimized for BI (business intelligence)
  - Applications performing real-time processing of big unstructured data

---

## EC2 Instance Types - Storage Optimized
- 로컬 스토리지에 있는 많은 데이터 세트에 액세스할 때 유용
- 사용 사례 
  - hih frequency online transaction processing (OLTP) systems
  - Relational & NoSQL database
  - Cache for in-memory database (for example : Redis)
  - Data warehousing applications
  - Distributed file systems

---

# 3. Security Groups & Classic Ports Overview
## Introduction to Security Groups
- EC2 인스턴스로 교통 통제 담당
- 허용 규칙 생성
- 컴퓨터가 어디서 왔는지 ip주소나 다른 보안그룹을 참조 가능
- 보안그룹은 서로를 참조 가능               
<img src="{{ '/assets/img/images/aws/ec2_traffic.png' | relative_url }}" alt="스크린샷" width="300">

---

## Security Groups Deeper Dive
- 보안 그룹은 EC2 인스턴스에 **firewall**로 행함
- 규칙
  - Access to Ports
  - Authorised IP ranges - IPv4 and IPv6
  - Control of inbound network (from other to the instance)
  - Control of outbound network (from the instance to other)

---

## Security Groups Diagram
<img src="{{ '/assets/img/images/aws/ec2_diagram.png' | relative_url }}" alt="스크린샷" width="300">

---

## Security Groups Good to know
- 여러 개의 인스턴스에 부착 가능
- 보안 그룹과 인스턴스 사이에 1대1 관계는 없음
- 인스턴스는 여러개의 보안그룹을 가질 수 있음
- 다른 리전을 이행하려면 보안그룹 또는 다른 VPC를 만들어야함
- 보안은 EC2 밖에 없음
- 트래픽이 막히면 EC2 인스턴스가 보이지 않음
- SSH 액세스를 위해 별도 하나의 보안그룹을 유지하는게 좋음 SSH가 복잡하기 때문
- **기본으로 모든 내부 트래픽을 막고 외부 트래픽을 허용**

---

## Referencing other security groups Diagram
- 보안 그룹으로부터 보안 그룹을 참조하는 방법           
<img src="{{ '/assets/img/images/aws/ec2_security.png' | relative_url }}" alt="스크린샷" width="300">                               
1) 인바우드 규칙에서 보안그룹 1,2 그룹을 승인함
2) EC2 인스턴스의 ip에 상관없이 보안 그룹이 부작되어 있기 때문에 다른 인스턴스와 직접 통신가능 그러므로 장점은 ip에 대해 항상 생각하지 않게 되어 좋음

---

## Classic Port to know
- 22 = SSH (Secure Shell) - log into Linux instance
- 21 = FTP (File Transfer Protocol) - upload files into a file share
- 22 = SFTP (Secure File Transfer Protocol) - upload files using SSH
- 80 = HTTP - access unsecured websites
- 443 = HTTPS - access secured websites
- 3389 = RDP (Remorte Desktop Protocol) - log into a Windows instance

---

# 4. SSH Overview

| OS / Tool         | SSH  | Putty  | EC2 Instance Connect  |
|-------------------|--------|----------|---------------------------|
| **Mac**           | ✔️     |          | ✔️                        |
| **Linux**         | ✔️     |          | ✔️                        |
| **Windows < 10**  |        | ✔️       | ✔️                        |
| **Windows ≥ 10**  | ✔️     | ✔️       | ✔️                        |    

- Mac / Linux : SSH on Mac/Linux lecture
- Windows : Putty Lecture, If Window 10, SSH on Windows 10 lecture
- All : EC2 Instance Connect lecture

---

# 5. EC2 Instance Purchasing Options
## EC2 Instances Purchasing Options
- On-Demand Instances : 단기 워크로드에 적합하며, 예측가능한 가격과 초 단위 청구가 특징
- Reserved : 
  - Reserved Instance : 1년 또는 3년 기간동안 제공되며, 장기 워크로드(ex: database)에 최대 72% 할인 혜택 제공
  - Convertible Reserved Instance : 인스턴스 유형 변경의 유연성을 제공하지만 할인폭은 최대 66%
- Saving Plans : 인스턴스 유형이 아닌 지정된 금액을 기준으로 할인을 제공하며, 인스턴스 크기 및 운영 체제에 대한 보다 큰 유연성을 허용
- Spot Instances : 최대 90% 할인된 가격으로 제공되지만, 스팟 가격이 사용자의 최고 입찰가를 초과하면 종료될 수 있어 신뢰성이 낮음
- Dedicated Hosts : 전체 물리적 서버에 접근 가능
- Dedicated Instances : 전용 하드웨어에서 실행되지만 다른 인스턴스와 공유 가능
- Capacity Reservations : 특정 가용 영역에서 온디맨드 인스턴스를 예약할 수 있지만 장기 약정 없이 확인 가능

---

## EC2 On Demand
- 사용한것의 지불
  - Linux or Windows - 시작 1분후 초당 청구
  - 다른 모든운영 체제에서도 시간당 청구
- 원가는 높고, 선급금도 없고 장기적인 계약도 없음 즉, 단기적이고 방해받지 않는 작업에 확실히 추천

---

## EC2 Reserved Instance
- On-demand보다 72% 할인
- 특정 인스턴스 속성을 정함 (ex: Instance Type, Region, Tenancy, OS)
- Reservation Period : 더 많은 할인을 받기 위해서는 1년이나 3년의 예약 기간을 명시
- Payment Options : 부분적으로 선지급 할지 말지 결정 (선지급 일경우, 최대할인 진행)
- Reserved Instance's Scope : 범위 측면에서 특정 지역이나 다른 지역으로 갈경우, 특정 AZ의 용량을 비축해야함
- 예약 인스턴스는 steady-state 사용 응용 프로그램을 위해 사용 (데이터베이스에 대해)
- 예약 인스턴스롤 시장에서 사거나 팔 수 있음 
- **Convertible Reserved Instance**
  - 인스턴스 형식, 패밀리 운영 체제, 범위 테넌트 형식을 바꿀 수 있게 해줌
  - 더 많은 유연성을 가질 수 있기에 할인을 덜받음 (66%까지 할인 가능)

---

## EC2 Saving Plans
- 장기 사용량에 따라 할인을 받을 수 있도록 해줌 (70%)
- 주문형 가격으로 청구 (1,2,3년간 시간당 10달러 쓰고 싶다면)
- 특정 인스턴스에 묶이게 됨

---

## EC2 Spot Instance
- 최대 90% 할인 가능
- 하지만, 언제든 잃을 수 있음, 점포에 넘어가면 사지 못함
- AWS에서 가장 비용이 효율적인 인스턴스
- 실패에 대한 회복력이 있는 작업을 가지고 있다면 적합
  - Batch jobs
  - Data analysis
  - Image processing
  - Any distributed workloads
  - Workloads with a flexible start and end time
- 주요 업무와 데이터베이스에 적합하지 않음

---

## EC2 Dedicated Hosts
- 규정 준수 요구사항이 있거나 기존 서버표시 소프트웨어 라이선스를 사용
- VM 소프트웨어 라이선스 당, 소켓 당, 코어 당에 기반으로 결제
- 구매 옵션 :
  - 물리적 서버에 액세스해 전용 호스크를 얻는 경우 호스트는 온디맨드로 구매
  - 1초당 요금을 내거나 1-3년간 예약 가능
- AWS에서 가장 비싼 옵션 (물리적 서버를 예약하기 때문)
- 라이선싱 모델이 있는 소프트웨어가 있을때 즉, 자신의 라이선스를 가져오는 소프트웨어 일 경우
- 규제 및 준수 요구가 강한 회사를 소유한 경우

---

## EC2 Dedicated Instance
- 같은 계정의 다른 인스턴스와 하드웨어를 공유 하지만 배치에 대한 제어는 할 수 없음
- 하드웨어에 인스턴스를 갖음
- 호스트는 물리적 서버 자체에 접근해 하위 레벨 하드웨어에 표시 유형을 제공

---

## EC2 Capacity Reservations
- 특정 AZ에 온디맨드 인스턴스를 일시적으로 저장 가능 그러면 필요할때마다 해당 용량에 액세스 가능하며 시간 제한이 없기 때문에 언제든 예약을 취소하거나 예약할 수 있음
- 할인은 안됨 (용량을 비축하는게 유일한 목적이기 때문)
- 만약, 할인 받고 싶다면 지역 예약 인스턴스나 적금 플랜과 결합해야함
- 인스턴스를 돌리든 안돌리든 상관없이 요금은 고정값!
- 특정 AZ에 있어야하는 단기 작업에 아주 적합

---

## Which purchasing option is right for me? (호텔로 비유)
- On demand : 언제든 들어가고, 쓴 만큼만 돈 내는 리조트
- Reserved : "1~3년 오래 묵을게요" → 장기 예약으로 할인
- Saving Plans : "매달 300달러는 쓸게요, 방은 바꿔도 되죠!"
- Spot instances : "빈방 있으니 싸게 드림. 하지만 언제든 퇴실시키기 가능."
- Dedicated Hosts : "저 호텔 전체 빌려주세요. 건물 전체가 우리 거예요."
- Capacity Reservations : "방은 쓸지 몰라도, 자리만 확보할게요. 비용은 전액 냅니다."

> 가격 비교 :               
> 스팟 → 가장 싸지만 안정성 없음                    
> RI / 저축 플랜 → 장기간 사용 시 가장 효율적                
> 온디맨드 → 가장 비싸지만 자유로움                 
> 용량 예약 → 자리 확보 용도, 비용은 비쌈                   

> Point!!!                 
> 예측 가능한 장기 워크로드 → RI / 저축 플랜              
> 갑자기 늘었다 줄었다 하는 작업 → 온디맨드              
> 매우 저렴하게 배치 작업 → 스팟                      
> 특정 지역·인스턴스 타입 자리 확보 필수 → 용량 예약                 

---

# 6. Spot Instances & Spot Fleet
## EC2 Spot Instance Requests
- AWS에서 남는 EC2 용량을 저렴하게 제공하는 방식
- 온디맨드 대비 최대 90% 할인 가능
- 단점: AWS가 언제든 인스턴스를 회수(중단/종료)할 수 있음

---

## EC2 Spot Instance Pricing
- 최대 지불 가격(Max Price) 설정
- 사용자가 시간당 지불할 최대 가격을 정의
- Spot 가격이 Max Price 이하면 실행 유지
- Spot 가격이 Max Price 이상이면 인스턴스가 회수
- 회수 유예 시간
  - 회수되기 전에 2분의 유예 시간이 제공

--- 

## How to terminate Spot Instances?
- Stop(정지)
  - 중단 후 스팟 가격이 내려가면 다시 시작할 수 있음
- Terminate(종료)
  - 인스턴스를 삭제
  - 필요 시 새로운 인스턴스를 생성

---

## Spot Fleets
- 1~6시간 동안 중단되지 않고 스팟 인스턴스를 유지할 수 있는 기능
- 드물게 중단될 수 있으나 대부분 안정적
- 짧게 실행하는 중요한 작업에 적합
- Spot 인스턴스 적합한 작업
  - 배치 작업
  - 데이터 분석
  - 분산 처리 작업
  - 일시적 CI/CD 서버
  - 주의: 데이터베이스나 중단되면 안 되는 중요한 워크로드에는 부적
- Spot 가격 변동
  - 가용 영역(AZ)에 따라 가격이 다르게 형성
  - 시간 흐름에 따라 큰 폭으로 변화할 수 있음
  - Spot 가격이 Max Price보다 올라가면 인스턴스를 잃게 됨
- Spot 요청(Spot Request)
  - 요청 방식 두 가지
    - 단일 요청 (One-time Request)
      - 인스턴스 1개 실행 후 요청이 사라짐
      - 인스턴스가 중단되면 자동으로 재생성되지 않음
    - 지속 요청 (Persistent Request)
      - 사용자가 원하는 인스턴스 수를 계속 유지하려는 목적
      - 인스턴스가 중단되면 자동으로 다시 시작·재생성
- **Spot 요청을 취소하는 올바른 순서**
  - Spot Request 먼저 취소
  - 관련 Spot Instance 그다음 종료
  - 순서를 바꾸면 Spot Request가 다시 인스턴스를 생성
- Spot Fleet(스팟 함대)
  - 여러 AZ, 여러 인스턴스 종류를 조합하여 가장 저렴한 스팟 인스턴스를 자동으로 선택해 실행하는 기능
  - 목표 용량(Target Capacity)을 자동으로 맞춤
- Spot Fleet 실행 전략
  - lowestPrice (최저가)
    - 가장 싼 스팟 풀에서만 인스턴스를 실행
    - 비용 절감 극대화
    - 짧은 작업에 적합
  - diversified (분산)
    - 여러 풀에 분산 배치
    - 한 풀에서 회수되어도 다른 풀이 살아있어 안정적
  - capacityOptimized (용량 최적화)
    - 스팟 용량이 많은 풀을 우선적으로 선택
    - 스팟 회수 위험이 가장 낮음
    - 안정성이 중요한 작업에 적합
- capacity Optimized Prioritized
  - 용량 최적화 + 우선순위 조합 방식
  - 대부분의 작업에서 추천
- Spot 인스턴스 유형 비교표

| 기능 | 단일 요청 (One-time) | 지속 요청 (Persistent) | Spot Block | Spot Fleet |
|------|------------------------|--------------------------|------------|-------------|
| 자동 재생성 | X | O | X | O |
| 중단 가능성 | 높음 | 높음 | 매우 낮음 | 전략에 따라 다름 |
| 사용 목적 | 단발성 작업 | 지속 유지 | 1~6시간 고정 | 자동 비용 최적화 |
| 비용 절감 | 최대 90% | 최대 90% | 최대 90% | 최대 90% |

---

## 핵심 요약
- Spot 인스턴스는 최대 90% 비용 절약 가능
- Spot 가격이 Max Price를 초과하면 종료
- 지속 요청은 자동 재생성 기능 제공
- 취소 시 Spot Request 먼저 취소 → 그 후 인스턴스 종료
- Spot Fleet은 여러 인스턴스 타입·AZ 조합으로 가장 저렴한 옵션 자동 선택 기능을 제공

---
