---
layout: post
title: " 5.AWS(SAA) - High Availability and Scalability : ELB & ASG (Eng.ver) "
date: 2026-01-11
categories:
  - "Certification/AWS SAA"
---

#### Reference
- [Udemy – AWS Certified Solutions Architect Associate (SAA-C03)](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/?couponCode=CP251120G2)

# 1. High Availability and Scalability 
## Scalability & High Availability
- Scalability means that an application / system can handle greater loads by adapting
- There are two kinds of scalability : 
  - Vertical Scalability
  - Horizontal Scalability (= elasticity)
- Scalability is linked but different to High Availability

## Vertical Scalability
- Vertically scalability means increasing the size of the instance
- For example, your application runs on a t2.micro
- Scaling that application vertically means running it on a t2.large
- Vertical scalability is very common for non distributed systems, such as a database
- RDS, ElastiCache are services that can scale vertically
- There's usually a limit to how much you can vertically scale (hardware limit)

## Horizontal Scalability
- Horizontal Scalability menas increasing the number of instances / systems for your application
- Horizontal scaling implies distributed systems
- This is very common for web applications / modern applications
- It's easy to horizontally scale thanks the cloud offerings such as Amazon EC2

## High Availability
- High availability usually goes hand in hand with horizontal scaling
- High availability means running your application / system in at least 2 data centers (== availability zones)
- The goal of high availability is to survive a data center loss
- The high availability can be passive (for RDS Multi AZ)
- The high availability can be active (for horizontal scaling)

## High Availability & Scalability For EC2
- Vertical Scaling : Increase instance size (= scale up / down)
  - From: t2.nano - 0.5G og RAM, 1 vCPU
  - To : u- 12tb 1.metal - 12.3 TB of RAM, 448 vCPUs
- Horizontal Scaling : Increase number of instance ( = scale out / in)
  - Auto Scaling Group
  - Load Balancer
- High Availability : Run instances for the same application across multi AZ
  - Auto Scaling Group multi AZ
  - Load Balancer multi AZ

# 2. Elastic Load Balancing(ELB) Overview
## What is Load Balancing?
- Load Balances are servers that forward traffic to multiple servers (e.g., EC2 instances) downstream

<img src="{{ '/assets/img/images/aws/loadbalancer.png' | relative_url }}" alt="스크린샷" width="300"> 

## Why use a load balancer?
- Spread load across multiple downstream instances
- Expose a single point of access (DNS) to youor application
- Seamlessly handle failures of downstream instances
- Do regular health checks to your instances
- Provide SSL termination (HTTPS) for your websites
- Enforce stickiness with cookies
- High availability across zones
- Separate public traffic from private traffic

## Why use an Elastic Load Balancer?
- An Elastic Load Balancer is a managed load balancer
  - AWS guarantees that it will be working
  - AWS takes care of upgrades, maintenance, high availability
  - AWS provides only a few configuration knobs
- It costs less to setup your own load balancer but it will be a lot of more effort on your end
- It is integrated with many AWS offering / services
  - EC2, EC2 Auto Scaling Groups. Amazon ECS
  - AWS Certificate Manager (ACM), CloudWatch
  - Route 53, AWS WAF, AWS Global Accelerator

## Health Checks
- Health Ckecks are crucial for Load Balancers
- They enable the load balancer to know if instances it forwards traffic to are available to reply to requests
- The health ckeck is done on a port and a route (/health is common)
- If the response is not 200 (OK), then the instance is unhealthy

<img src="{{ '/assets/img/images/aws/healthcheck.png' | relative_url }}" alt="스크린샷" width="300"> 

## Types of load balancer on AWS
- AWS has 4 kinds of managed Load Balancers
- Classic Load Balancer (v1 - old generation) - 2009 - CLB
  - HTTP, HTTPS, TCP, SSL (secure TCP)
- Application Load Balancer (v2 - new generation) - 2016 - ALB
  - HTTP, HTTPS, WebSocket
- Network Load Balancer (v2 - new generation) - 2017 - NLB
  - TCP, TLS (secure TCP), UDP
- Gateway Load Balancer - 2020 - GWLB
  - Operates at layer 3 (Network layer) - IP Protocol

> Overall, it is recommended to use the newer generation load balancers as they provide more features
> Some load balancers can be setup as internal (private) or external (public) ELBs

## Load Balancer Security Groups

<img src="{{ '/assets/img/images/aws/LB-SG.png' | relative_url }}" alt="스크린샷" width="300"> 

| Type  | Protocol | Port | Source      | Description                    |
|------|----------|------|-------------|--------------------------------|
| HTTP | TCP      | 80   | 0.0.0.0/0   | Allow HTTP from Internet       |
| HTTPS| TCP      | 443  | 0.0.0.0/0   | Allow HTTPS from Internet      |

| Type  | Protocol | Port | Source                         | Description                                |
|------|----------|------|--------------------------------|--------------------------------------------|
| HTTP | TCP      | 80   | Load Balancer Security Group   | Allow traffic only from Load Balancer     |

# 3. Application Load Balancer (ALB)
## Application Load Balancer (v2)
- Routing tables to different target groups :
  - Routing based on path in URL (example.com/users & example.com/posts)
  - Routing based on hostname in URL (one.example.com & other.example.com)
  - Routing based on Query String, Headers (example.com/users?id=123&order=false)
- ALB are a great fit for micro services & container-based application (example : Docker & Amazon ECS)
- Has a port mapping feature to redirect to a dynamic port in ECS

> In comparison, we'd need multiple Classic Load Ballancer per application

## Application Load Balancer (v2) HTTP Based Traffic

<img src="{{ '/assets/img/images/aws/Application LB.png' | relative_url }}" alt="스크린샷" width="300"> 

## Application LOad Balancer (v2) Target Groups
- EC2 instance (can be managed ) - HTTP
- EC2 tasks (managed by EC2 itself) - HTTP
- Lambda functions - HTTP request is translated into a JSON event
- IP Addresses - must be private IPs
- ALB can route to multiple target groups
- Health checks are at the target group level

## Application LOad Balancer (v2) Query String / Parameter Routing

<img src="{{ '/assets/img/images/aws/Application LB-query-para.png' | relative_url }}" alt="스크린샷" width="300"> 

## Application LOad Balancer (v2) Good to Know
- Fixed hostname (xxx.region.elb.amazonaws.com)
- The application servers don't see the IP of the client directly
  - The true IP of the client is inserted in the header X-Forwarded-For
  - We can also get Port (X-Forwarded-Port) and proto (X-Forwarded-Proto)

<img src="{{ '/assets/img/images/aws/alb-good to know.png' | relative_url }}" alt="스크린샷" width="300"> 

# 4. Network Load Balancer (NLB)
## Network Load Balancer (v2)
- Network load balancers (Layer 4) allow to :
  - Forward TCP & UDP traffic to your instance
  - Handle millions of request per seconds
  - Ultra-low latency
- NLB has one static IP per AZ, and supports assigning Elastic IP (helpful for whitelisting specific IP)
- NLB are used for extreme performance, TCP or UDP traffic

## Network Load Balancer (v2) TCP (Layer 4) Based Traffic

<img src="{{ '/assets/img/images/aws/Network LB.png' | relative_url }}" alt="스크린샷" width="300"> 

## Network Load Balancer - Target Groups
- EC2 Instances
- IP Addresses - must be private IPs
- Application Load Balancer
- Health Checks support the TCP, HTTP and HTTPS Protocols

<img src="{{ '/assets/img/images/aws/NLB targetgroup.png' | relative_url }}" alt="스크린샷" width="300"> 

# 5. Gateway Load Balancer (GWLB)
## Gateway Load Balancer
- Deploy, scale, and manage a fleet of 3rd party network virtual applications in AWS
- Example : Firewalls, Intrusion Detection and Prevention Systems, Deep Packet Inspection Systems, payload mainpulation,...
- Operates at Layer 3 (Network Layer) IP Packets
- Combines the following functions : 
  - Transparent Network Gateway - single entry / exit for all traffic
  - Load balancer - distributes traffic to your virtual appliances
- Uses the GENEVE protocol on port 6081

<img src="{{ '/assets/img/images/aws/GatewayLoadBalancer.png' | relative_url }}" alt="스크린샷" width="300"> 

## Gateway Load Balancer - Target Groups
- EC2 Instances
- IP Addresses - must be private IPs

<img src="{{ '/assets/img/images/aws/GLB-targetgroups.png' | relative_url }}" alt="스크린샷" width="300"> 

# 6. Elastic Load Balancer - Sticky Sessions
## Sticky Sessions (Session Affinity)
- It is possible to implement stickness so that the same client is always redirected to the same instance behind a load balancer
- This works for Classic Load Balancer, Application Load Balancer, and Network Load Balancer
- The "cookie" used for stickiness has an expiration data you control
- Use case : make sure the user doesn't lose his session data
- Enabling  stickiness may bring 
 to the load over the backend EC2 instances

<img src="{{ '/assets/img/images/aws/Sticky Sessions.png' | relative_url }}" alt="스크린샷" width="300"> 

 ## Sticky Sessions - Cookie Names
 - Application-based Cookies
  - Custom cookie
    - Generated by the target
    - Can include anny custom attributes required by the application
    - Cookie name must be specified individually for each target group
    - Don't use AWSSALB, AWSSALBAPP, or AWSSALBTG (reserved for use by the ELB)
  - Application cookie
    - Generated by the load balancer
    - Cookie name is AWSSALBAPP
- Duration-based Cookies
  - Cookie generated by the load balancer
  - Cookie name is AWSALB for ALB,AESELB for CLB

# 7. Elastic Load Balancer - Cross Zone Load Balancing
## Cross - Zone Load Balancing

<img src="{{ '/assets/img/images/aws/Cross-ZoneLB.png' | relative_url }}" alt="스크린샷" width="300"> 

- Application Load Balancer
  - Enabled by default (can be disabled at the Target Group level)
  - No charges for inter AZ data
- Network Load Balancer & Gateway Load Balancer
  - Disabled by default
  - You pay charges for inter AZ data if enabled
- Classic Load Balancer
  - Disabled by default
  - No charges for inter AZ data if enabled

# 8. Elastic Load Balancer - SSL Certificates
## SSL / TLS - Basics
- An SSL Certificate allows traffic between your clients and your load balancer to be encrypted in transit ( in-flight encryption)
- SSL refers Secure Sockets Layer, used to encrypt connections
- TLS refers to Transport Layer Security, which is a newer version
- Nowadays, TLS certificates are mainly used, but people still refer as SSL
- Public SSL certificates are issued by Certificate Authorities (CA)
- Comodo, Symantec, GoDaddy, GlobalSign, Digicert, Letsencrypt,...
- SSL certificates have an expiration data ( you set) and must be renewed

## Load Balancer - SSL Certificates

<img src="{{ '/assets/img/images/aws/LB-SSLCertificates.png' | relative_url }}" alt="스크린샷" width="300">

- The load balancer uses an X.509 certificate (SSL/TLS server certificate)
- You can manage certificates using ACM (AWS Certificate Manager)
- You can create upload your own certificates alternatively
- HTTPS listener :
  - You must specify a default certificate
  - You can add an optional list of certs to support multiple domains
  - Clients can use SNI (Server Name Indication) to specify the hostname thry reach
  - Ability to specify a security policy to support older versions of SSL / TLS (legacy clients)